---
title: 9、从输入ULR到看到页面，中间经历了什么？
sidebarDepth: 0
---
[[toc]]
# 从输入ULR到看到页面，中间经历了什么？
主要分为三个阶段(请求`request`、响应`response`、渲染`dom render`)；

## 判断输入URL是否有效
::: tip URL判断
首先会对`URL`进行解析，判断`URL`中的协议或主机名是否合法，如果不合法，将会把输入的内容传递给搜索引擎。如果没问题则进行下一步；
:::

## 解析域名对应的IP地址
::: 解析URL
`DNS`解析步骤如下
- 首先会从浏览器缓存中查找是否有这个网址对应的`IP`地址（没有就下一步）
- 再到当前操作系统中的`DNS缓存(window是host文件)`中查找
- 继续向路由的`DNS`缓存中查找
- 没有继续向`ISP`的`DNS`缓存中查找

所以`IP`的查找顺序就是 `浏览器 -> 系统 -> 路由器 -> ISP`。如果在某一个缓存中找到就直接进入下一步。如果没有找到就会向`ISP`或者公共的域名解析服务器发送`DNS`查找请求。

一般客户端向本地`DNS`服务器发送查找请求到返回结果是递归查询（收到请求，给出结果）
本地`DNS`服务器向其他服务器发送查找请求，收到其他服务器给出另一个`DNS`服务器地址，然后本地`DNS`服务器再向最新给到的`DNS`服务器地址发出请求，直到返回查询的`IP`地址为止，这个过程是迭代查询（不更换发出请求者）
<img :src="$withBase('/assets/browser-dnsParse.jpeg')" alt="browser-dnsParse">
<!-- TODO -->
- 3、开始解析获取`URL`对应的`IP`地址
  - 先到浏览器缓存中读取上一次访问的记录（没有的话下一步）
  - 再到操作系统的内存中查找
  - 到本机C盘的host文件中查找是否有对应的`IP`
  - 没有的话向本地`DNS`服务器发起请求。
  - 再没有的话本地`DNS`服务器通过迭代查找，最终向本地`DNS`服务器返回这个域名对应的`IP`；
  - 本地`DNS`服务器把`IP`地址发送给用户，并把对应关系缓存起来，以便下次查找。
- 4、通过找到的外网`IP`，开始建立`TCP`链接（三次握手）
- 5、建立链接后，客户端开始发送`HTTP`请求；

*[`Response`响应阶段]*

- 6、服务器开始处理请求，根据端口号和文件路径（没输入是因为不同协议有自己不同的默认端口号）找到服务器上对应的项目，并把项目源码通过`HTTP`等协议返回给客户端；
- 7、断开`TCP`链接四次挥手

*[浏览器渲染阶段]*

- 8、客户端接收到源代码后，会交给浏览器的内核进行渲染，最后由浏览器绘制出对应的页面
  - 首先解析`HTML`，计算`DOM`结构，生成`DOM Tree`。
  - 解析`CSS`资源，生成`Style Rules`；
  - 当解析遇到`script`标签的 时候，会停止解析文档，开始解析脚本，会将脚本中改变`DOM`和`CSS`的地方解析出来，追加到`DOM Tree`和`style rules`上；
  - `DOM Ttree` 结合`Style rules` 生成`render  Tree`；
  - 根据`render Tree`开始布局和绘制页面；
:::